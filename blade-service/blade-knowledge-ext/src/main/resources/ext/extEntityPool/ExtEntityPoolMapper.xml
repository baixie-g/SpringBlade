<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tech.qiantong.qknow.common.ext.mapper.extEntityPool.ExtEntityPoolMapper">

    <resultMap id="BaseResultMap" type="tech.qiantong.qknow.common.ext.dataobject.extEntityPool.ExtEntityPoolDO">
        <id column="id" property="id"/>
        <result column="workspace_id" property="workspaceId"/>
        <result column="task_id" property="taskId"/>
        <result column="doc_id" property="docId"/>
        <result column="paragraph_index" property="paragraphIndex"/>
        <result column="entity_id" property="entityId"/>
        <result column="entity_name" property="entityName"/>
        <result column="entity_type" property="entityType"/>
        <result column="aliases" property="aliases"/>
        <result column="definition" property="definition"/>
        <result column="attributes" property="attributes"/>
        <result column="status" property="status"/>
        <result column="process_time" property="processTime"/>
        <result column="processor_id" property="processorId"/>
        <result column="process_by" property="processBy"/>
        <result column="process_remark" property="processRemark"/>
        <result column="valid_flag" property="validFlag"/>
        <result column="del_flag" property="delFlag"/>
        <result column="create_by" property="createBy"/>
        <result column="creator_id" property="creatorId"/>
        <result column="create_time" property="createTime"/>
        <result column="update_by" property="updateBy"/>
        <result column="updater_id" property="updaterId"/>
        <result column="update_time" property="updateTime"/>
        <result column="remark" property="remark"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, workspace_id, task_id, doc_id, paragraph_index, entity_id, entity_name, entity_type,
        aliases, definition, attributes, status, process_time, processor_id, process_by, process_remark,
        valid_flag, del_flag, create_by, creator_id, create_time, update_by, updater_id, update_time, remark
    </sql>

    <select id="selectList" parameterType="tech.qiantong.qknow.module.ext.controller.admin.extEntityPool.vo.ExtEntityPoolPageReqVO" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM ext_entity_pool
        WHERE del_flag = 0
        <if test="workspaceId != null">
            AND workspace_id = #{workspaceId}
        </if>
        <if test="taskId != null">
            AND task_id = #{taskId}
        </if>
        <if test="docId != null">
            AND doc_id = #{docId}
        </if>
        <if test="entityName != null and entityName != ''">
            AND entity_name LIKE CONCAT('%', #{entityName}, '%')
        </if>
        <if test="entityType != null and entityType != ''">
            AND entity_type = #{entityType}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
        ORDER BY id DESC
    </select>

    <insert id="insertBatch" parameterType="java.util.List">
        INSERT INTO ext_entity_pool (
            workspace_id, task_id, doc_id, paragraph_index, entity_id, entity_name, entity_type,
            aliases, definition, attributes, status, valid_flag, del_flag,
            create_by, creator_id, create_time, update_by, updater_id, update_time
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
                #{item.workspaceId}, #{item.taskId}, #{item.docId}, #{item.paragraphIndex},
                #{item.entityId}, #{item.entityName}, #{item.entityType}, #{item.aliases},
                #{item.definition}, #{item.attributes}, #{item.status}, #{item.validFlag}, #{item.delFlag},
                #{item.createBy}, #{item.creatorId}, #{item.createTime}, #{item.updateBy}, #{item.updaterId}, #{item.updateTime}
            )
        </foreach>
    </insert>

    <select id="selectByEntityId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM ext_entity_pool
        WHERE del_flag = 0
        AND entity_id = #{entityId}
        AND task_id = #{taskId}
        LIMIT 1
    </select>

</mapper>
